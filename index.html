<style>
.commentList li:first-child {
    border-top: 1px solid #eee;
}
.commentList .item {
    font-size: 1rem;
}
.commentList li {
    position: relative;
    border-bottom: 1px solid #eee;
    padding: 10px 0;
}
.item {
    text-align: left;
    cursor: pointer;
}
 
li {
    display: list-item;
}

.item .pic {
    float: left;
    margin-right: 10px;
}
div, a, p, ul, li, img, span {
    margin: 0;
    padding: 0;
    border: 0;
}
</style>


<textarea id="dome" class="commentArea"></textarea>
<div class="addMessageBtn">发布</div>
<div style="clear: both;"></div>
<ul class="commentList"></ul>

<script type="text/javascript"> 
function getOnePageMessage(id, page){
        var onePageMessageTmp;
    var messagePageCount;
    isLoading = false;
    $.ajax({
        url : serverPrefix + "/wbLeaveMessage/getLeaveMessage",
        type : "get",
        dataType: "json",
        data: {
            wbId: id,
            messageType: 1,
            page: page,
            pageSize: 10
        },
        success : function (data) {
            if (data.code == 0){
                messagePageCount = data.result.pageCount;
                onePageMessageTmp = data.result.leaveMessages;
                if ((onePageMessageTmp.length == 0) || (messagePageCount == 1)) {       // 无数据或只有一页数据，隐藏加载提示
                    $("#loading").hide();
                }
                if (onePageMessageTmp.length != 0) {
                    addMessage(onePageMessageTmp);
                    isLoading = true;
                }
            }
            else{
                onePageMessageTmp.length = 0;
                $("#loading").hide();
            }
        }
    });
}

function addMessage(leaveMessages){
    var template = "";
    var html = "";
    for (var i = 0; i < leaveMessages.length; i++){
        template = '<li class="item" id="{id}">';
        template += '    <div class="pic">';
        template += '        <img src="http://images.v2gogo.com/{headImgUrl}">';          // 用户头像
        template += '    </div>';
        template += '    <div class="info">';
        template += '        <div class="name">{fullname}</div>';
        template += '        <div class="time">{createTime}</div>';
        template += '        <div class="content">{content}</div>';
        template += '        <div class="userName" style="display: none">{username}</div>';
        template += '    </div>';
        template += '</li>';
 
        var timestamp = leaveMessages[i].createTime;           // 时间戳设置为北京时间
        leaveMessages[i].createTime = formatDate(timestamp);
 
        var userimg = leaveMessages[i].headImgUrl;                 // 如果headImgUrl等于null,替换为默认路径
        if (userimg == null){
            leaveMessages[i].headImgUrl = "headPortrait/default_head_img.png";
        }
        html = template.formatString(leaveMessages[i]);
        $(".commentList").append(html);
    }
}
</script>
